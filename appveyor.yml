version: 0.0.1
os: Visual Studio 2017

test: off

artifacts:
- path: '.\artifacts\packages\*.nupkg'

on_failure:
  - ps: Update-AppveyorBuild -Version "$($env:APPVEYOR_BUILD_VERSION)-$(Get-Date -format HHmmss)-failed"
  - ps: $wc = New-Object 'System.Net.WebClient'
  - ps: Resolve-Path .\artifacts\test-results\*.trx | ForEach-Object { $wc.UploadFile("https://ci.appveyor.com/api/testresults/mstest/$($env:APPVEYOR_JOB_ID)", $_) }

for:
  -
    branches:
      only:
        - master

    build_script:
      - ps: .\build.ps1 -ScriptArgs '-task="Server" -nugetApiKey="$($env:Nuget_ApiKey)" -version="$($env:APPVEYOR_BUILD_VERSION)" -isLocal=false'

  -
    branches:
      except:
        - master
  
    build_script:
      - ps: .\build.ps1 -ScriptArgs '-task="Server" -nugetApiKey="$($env:Nuget_ApiKey)" -version="$($env:APPVEYOR_BUILD_VERSION)-$($env:APPVEYOR_BUILD_NUMBER).$($env:APPVEYOR_REPO_BRANCH)" -isLocal=false'